<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Node-fastpass by jesseditson</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Node-fastpass</h1>
        <p class="header">A node.js library for getsatisfaction fastpass (single sign-on)</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/jesseditson/node-fastpass/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/jesseditson/node-fastpass/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/jesseditson">jesseditson</a></p>


      </header>
      <section>
        <h1>node-fastpass</h1>

<p>A node.js library for getsatisfaction fastpass (single sign-on)</p>

<p>This serves as a drop-in replacement for the existing getsatisfaction fastpass libraries, and implements the same method signatures (with some defaulting for ease of use) as the ruby library.
Documentation for existing fastpass libraries can be found <a href="http://getsatisfaction.com/corp/help/fastpass-implementation.html">on the getsatisfaction help site</a>.</p>

<hr><h2>Usage:</h2>

<p>Add the dependency:</p>

<pre><code>npm install --save fastpass
</code></pre>

<p>Require it:</p>

<pre><code>var FastPass = require('fastpass')
</code></pre>

<p>Instantiate it:</p>

<pre><code>var fastPass = new FastPass({
   // optional, defaults to "getsatisfaction.com"
   domain : "getsatisfaction.com",
   // required, your consumer key
   consumer_key : "xi2vaxgpp06m",
   // required, your consumer secret
   consumer_secret : "ly68der0hk8idfr5c73ozyq56jpwstd1",
   // optional at instantiation - email of the user
   email : "scott@getsatisfaction.com",
   // optional at instantiation - Name of the user
   name : "Scott",
   // optional at instantiation - unique ID of user (must stay the same for the lifetime the user in your system)
   unique_identifier : "nullstyle",
   // optional boolean, defaults to false
   is_secure : false,
   // optional object, any private fields you like. defaults to {}.
   private_fields : {}
})
</code></pre>

<h3>Implementation:</h3>

<h4>Using the Script tag</h4>

<pre><code>fastPass.script({
  email : "scott@getsatisfaction.com",
  name : "Scott",
  unique_identifier : "nullstyle"
}, function(err,script){
  var outputScript = script
})
</code></pre>

<p>or if you passed <code>name</code>, <code>unique_identifier</code>, and <code>email</code> at instantiation:</p>

<pre><code>fastPass.script(function(err,script){
  var outputScript = script
})
</code></pre>

<p>Now replace all links to getSatisfaction with calls to <code>GSFN.goto_gsfn()</code></p>

<pre><code>// for instance, in jQuery
$('body').on('click','a[href="http://getsatisfaction.com"]',function(){ GSFN.goto_gsfn(); return false; })
</code></pre>

<h4>Using Cookies along with CNAME</h4>

<p>Set a cookie named "fastpass" to the URL generated by the FastPass library. Note: This is only available if your company is using the CNAME feature.</p>

<pre><code>// inside of an express route or whatever:
fastPass.url(&lt;options&gt;,function(err,url){
  cookies["fastpass"] = url
})
</code></pre>

<h4>Using the Query String</h4>

<p>Include the generated URL in the param named "fastpass" in all links to Get Satisfaction.</p>

<pre><code>// in some template context
fastPass.url(&lt;options&gt;,function(err,url){
  var linkUrl = "&lt;a href="http://getsatisfaction.com/mycompany?fastpass=" + url + "&gt;Our Support Community&lt;/a&gt;"
})
</code></pre>

<h4>Option Details:</h4>

<pre><code>Field         |  Required  |  Notes
Key           |    Yes     |
Secret        |    Yes     |
Email         |    Yes     |
Name          |    Yes     |
Unique Id     |    Yes     | Must remain unchanged for the lifetime of the user's account in your system.
Is Secure     |    No      | (defaults to false)
Private Fields|    No      | Key/value pairs to send along with the user to Get Satisfaction.
</code></pre>

<hr><h3>Example Setup:</h3>

<p>The getSatisfaction setup is bi-directional, the smoothest sign on process happens when you have a CNAME set, a cookie with the current user, and a GSFN script on the page after login.</p>

<p>In an express server, here's how that might look:</p>

<pre><code>// Assumes that you've require'd and instantiated FastPass with your credentials.
// a-la: var fastPass = new FastPass(&lt;options&gt;)

// getsatisfaction middleware
// assumes that you've got authentication middleware before this that sets `req.authenticated` and adds `user` to `req.session`.
// these assumptions can obviously be replaced by however your app works, this should get you most of the way there.
app.use(function(req,res,next){
  if(req.authenticated){
    // add a cookie for getSatisfaction single sign on
    // crudely strips the subdomain - probably should be smarter to avoid clobbering non-subdomain urls.
    var cookieDomain = req.headers.host.replace('^[^\.]*',''),
        user = req.session.user
    fastPass.url({name : user.first_name + " " + user.last_name, email : user.email, unique_identifier : user.id },function(err,url){
      // this is the important part - sets a cookie for your domain.
      res.cookie('fastpass',url, {domain : cookieDomain})
      next()
    })
  } else {
    next()
  }
})
</code></pre>

<p>You'll also need to expose the script on all your logged-in pages:</p>

<pre><code>app.get('/some/logged/in/route',function(req,res){
  var user = req.session.user
  fastPass.script({name : user.first_name + " " + user.last_name, email : user.email, unique_identifier : user.id },function(err,script){
    // do your res.send() or whatever, render the script
  })
})
</code></pre>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-32786711-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>